<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>大文件上传 | SupremeMonster</title>
    <meta name="description" content="Frontend">
    <link rel="stylesheet" href="/assets/style.f9ffe3f5.css">
    <link rel="modulepreload" href="/assets/app.437f86da.js">
    <link rel="modulepreload" href="/assets/articles_components_fileUpload.md.e53cb76d.lean.js">
    
    <script id="check-dark-light">(()=>{const e=localStorage.getItem("vitepress-theme-appearance"),a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-ca9ccb7e><!--[--><!--]--><!--[--><span tabindex="-1" data-v-151f2593></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-151f2593> Skip to content </a><!--]--><!----><header class="VPNav" data-v-ca9ccb7e data-v-a71a30f1><div class="VPNavBar has-sidebar" data-v-a71a30f1 data-v-a35e6f52><div class="container" data-v-a35e6f52><div class="VPNavBarTitle has-sidebar" data-v-a35e6f52 data-v-d5925166><a class="title" href="/" data-v-d5925166><!--[--><!--]--><!--[--><img class="VPImage logo" src="/logo.jpg" data-v-e13a1912><!--]--><!--[-->SupremeMonster<!--]--><!--[--><!--]--></a></div><div class="content" data-v-a35e6f52><!--[--><!--]--><!----><!----><!----><div class="VPNavBarAppearance appearance" data-v-a35e6f52 data-v-a3e7452b><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" data-v-a3e7452b data-v-968780f1 data-v-086e8519><span class="check" data-v-086e8519><span class="icon" data-v-086e8519><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-968780f1><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-968780f1><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-a35e6f52 data-v-738bef5a data-v-f6988cfb><!--[--><a class="VPSocialLink" href="https://github.com/SupremeMonster" target="_blank" rel="noopener" data-v-f6988cfb data-v-e57698f6><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-a35e6f52 data-v-e89b88d7 data-v-6ffb57d3><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-6ffb57d3><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-6ffb57d3><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-6ffb57d3><div class="VPMenu" data-v-6ffb57d3 data-v-1c5d0cfc><!----><!--[--><!--[--><!----><div class="group" data-v-e89b88d7><div class="item appearance" data-v-e89b88d7><p class="label" data-v-e89b88d7>Appearance</p><div class="appearance-action" data-v-e89b88d7><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" data-v-e89b88d7 data-v-968780f1 data-v-086e8519><span class="check" data-v-086e8519><span class="icon" data-v-086e8519><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-968780f1><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-968780f1><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><div class="group" data-v-e89b88d7><div class="item social-links" data-v-e89b88d7><div class="VPSocialLinks social-links-list" data-v-e89b88d7 data-v-f6988cfb><!--[--><a class="VPSocialLink" href="https://github.com/SupremeMonster" target="_blank" rel="noopener" data-v-f6988cfb data-v-e57698f6><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-a35e6f52 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div><!----></header><div class="VPLocalNav" data-v-ca9ccb7e data-v-aac27d5e><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-aac27d5e><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-aac27d5e><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-aac27d5e>Menu</span></button><a class="top-link" href="#" data-v-aac27d5e> Return to top </a></div><aside class="VPSidebar" data-v-ca9ccb7e data-v-f332cb62><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-f332cb62><span class="visually-hidden" id="sidebar-aria-label" data-v-f332cb62> Sidebar Navigation </span><!--[--><div class="group" data-v-f332cb62><section class="VPSidebarGroup collapsible collapsed" data-v-f332cb62 data-v-2976c796><div class="title" role="button" data-v-2976c796><h2 class="title-text" data-v-2976c796>地图开发总结</h2><div class="action" data-v-2976c796><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-2976c796><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-2976c796><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-2976c796><!--[--><a class="VPLink link link" href="/articles/map-dev/mapbox.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>Mapbox</span><!----><!--]--><!----></a><a class="VPLink link link" href="/articles/map-dev/mapbox%E5%9C%B0%E5%9B%BE%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>Mapbox开发流程</span><!----><!--]--><!----></a><!--]--></div></section></div><div class="group" data-v-f332cb62><section class="VPSidebarGroup collapsible collapsed" data-v-f332cb62 data-v-2976c796><div class="title" role="button" data-v-2976c796><h2 class="title-text" data-v-2976c796>Angular高级</h2><div class="action" data-v-2976c796><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-2976c796><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-2976c796><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-2976c796><!--[--><a class="VPLink link link" href="/articles/angular/ngModule.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>NgModule</span><!----><!--]--><!----></a><a class="VPLink link link" href="/articles/angular/onPush.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>OnPush</span><!----><!--]--><!----></a><a class="VPLink link link" href="/articles/angular/viewEncapsulation.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>ViewEncapsulation</span><!----><!--]--><!----></a><a class="VPLink link link" href="/articles/angular/cli.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>Cli改造</span><!----><!--]--><!----></a><a class="VPLink link link" href="/articles/angular/asyncpipe.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>pure and async pipe</span><!----><!--]--><!----></a><a class="VPLink link link" href="/articles/angular/open-in-editor.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>Open-in-editor</span><!----><!--]--><!----></a><a class="VPLink link link" href="/articles/angular/httpInterceptors.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>Multi Http Intercepteors</span><!----><!--]--><!----></a><a class="VPLink link link" href="/articles/angular/reactiveForm.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>ReactiveForm</span><!----><!--]--><!----></a><a class="VPLink link link" href="/articles/angular/forwardRef.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>ForwardRef</span><!----><!--]--><!----></a><a class="VPLink link link" href="/articles/angular/zoneEventsBlacklist.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>Zone Events Blacklist</span><!----><!--]--><!----></a><a class="VPLink link link" href="/articles/angular/useProviders.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>Use providers</span><!----><!--]--><!----></a><a class="VPLink link link" href="/articles/angular/i18n.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>i18n</span><!----><!--]--><!----></a><a class="VPLink link link" href="/articles/angular/ng-components.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>Components</span><!----><!--]--><!----></a><a class="VPLink link link" href="/articles/angular/rxjs.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>RxJS</span><!----><!--]--><!----></a><a class="VPLink link link" href="/articles/angular/rxjs-operators.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>RxJS操作符</span><!----><!--]--><!----></a><!--]--></div></section></div><div class="group" data-v-f332cb62><section class="VPSidebarGroup collapsible" data-v-f332cb62 data-v-2976c796><div class="title" role="button" data-v-2976c796><h2 class="title-text" data-v-2976c796>组件封装</h2><div class="action" data-v-2976c796><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-2976c796><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-2976c796><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-2976c796><!--[--><a class="VPLink link link" href="/articles/components/silentLoadHLS.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>静默加载HLS流</span><!----><!--]--><!----></a><a class="VPLink link link active" href="/articles/components/fileUpload.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>大文件上传</span><!----><!--]--><!----></a><!--]--></div></section></div><div class="group" data-v-f332cb62><section class="VPSidebarGroup collapsible collapsed" data-v-f332cb62 data-v-2976c796><div class="title" role="button" data-v-2976c796><h2 class="title-text" data-v-2976c796>JavaScript高级</h2><div class="action" data-v-2976c796><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-2976c796><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-2976c796><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-2976c796><!--[--><a class="VPLink link link" href="/articles/javascript/Proxy.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>Proxy</span><!----><!--]--><!----></a><a class="VPLink link link" href="/articles/javascript/Reflect.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>Reflect</span><!----><!--]--><!----></a><a class="VPLink link link" href="/articles/javascript/Promise.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>Promise</span><!----><!--]--><!----></a><a class="VPLink link link" href="/articles/javascript/Decorator.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>Decorator</span><!----><!--]--><!----></a><a class="VPLink link link" href="/articles/javascript/EventLoop.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>EventLoop</span><!----><!--]--><!----></a><a class="VPLink link link" href="/articles/javascript/this.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>this</span><!----><!--]--><!----></a><a class="VPLink link link" href="/articles/javascript/closure.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>闭包</span><!----><!--]--><!----></a><a class="VPLink link link" href="/articles/javascript/scope.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>作用域和作用域链</span><!----><!--]--><!----></a><a class="VPLink link link" href="/articles/javascript/debounce-throttle.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>节流和防抖</span><!----><!--]--><!----></a><a class="VPLink link link" href="/articles/javascript/stringify.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>JSON stringify参数</span><!----><!--]--><!----></a><!--]--></div></section></div><div class="group" data-v-f332cb62><section class="VPSidebarGroup collapsible collapsed" data-v-f332cb62 data-v-2976c796><div class="title" role="button" data-v-2976c796><h2 class="title-text" data-v-2976c796>Chrome V8</h2><div class="action" data-v-2976c796><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-2976c796><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-2976c796><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-2976c796><!--[--><a class="VPLink link link" href="/articles/chromeV8/hiddenClass.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>隐藏类机制</span><!----><!--]--><!----></a><a class="VPLink link link" href="/articles/chromeV8/inlineCache.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>内联缓存</span><!----><!--]--><!----></a><a class="VPLink link link" href="/articles/chromeV8/lazyCompile.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>惰性解析</span><!----><!--]--><!----></a><a class="VPLink link link" href="/articles/chromeV8/gc.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>垃圾回收机制</span><!----><!--]--><!----></a><!--]--></div></section></div><div class="group" data-v-f332cb62><section class="VPSidebarGroup collapsible collapsed" data-v-f332cb62 data-v-2976c796><div class="title" role="button" data-v-2976c796><h2 class="title-text" data-v-2976c796>Webpack</h2><div class="action" data-v-2976c796><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-2976c796><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-2976c796><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-2976c796><!--[--><a class="VPLink link link" href="/articles/webpack/assets.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>Assets静态资源</span><!----><!--]--><!----></a><a class="VPLink link link" href="/articles/webpack/plugin.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>Plugin开发</span><!----><!--]--><!----></a><a class="VPLink link link" href="/articles/webpack/moduleFederation.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>Module Federation</span><!----><!--]--><!----></a><!--]--></div></section></div><div class="group" data-v-f332cb62><section class="VPSidebarGroup collapsible collapsed" data-v-f332cb62 data-v-2976c796><div class="title" role="button" data-v-2976c796><h2 class="title-text" data-v-2976c796>Nodejs</h2><div class="action" data-v-2976c796><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-2976c796><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-2976c796><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-2976c796><!--[--><a class="VPLink link link" href="/articles/nodejs/npm-run.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>npm run xxx</span><!----><!--]--><!----></a><a class="VPLink link link" href="/articles/nodejs/npm.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>npm包版本号含义</span><!----><!--]--><!----></a><!--]--></div></section></div><div class="group" data-v-f332cb62><section class="VPSidebarGroup collapsible collapsed" data-v-f332cb62 data-v-2976c796><div class="title" role="button" data-v-2976c796><h2 class="title-text" data-v-2976c796>Typescript</h2><div class="action" data-v-2976c796><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-2976c796><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-2976c796><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-2976c796><!--[--><a class="VPLink link link" href="/articles/typescript/%E9%80%86%E5%8F%98%E4%B8%8E%E5%8D%8F%E5%8F%98.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>逆变与协变</span><!----><!--]--><!----></a><a class="VPLink link link" href="/articles/typescript/json2Interface.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>json转interface</span><!----><!--]--><!----></a><!--]--></div></section></div><div class="group" data-v-f332cb62><section class="VPSidebarGroup collapsible collapsed" data-v-f332cb62 data-v-2976c796><div class="title" role="button" data-v-2976c796><h2 class="title-text" data-v-2976c796>Vue</h2><div class="action" data-v-2976c796><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-2976c796><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-2976c796><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-2976c796><!--[--><a class="VPLink link link" href="/articles/vue/%E5%93%8D%E5%BA%94%E5%BC%8F%E5%8E%9F%E7%90%86.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>响应式原理</span><!----><!--]--><!----></a><a class="VPLink link link" href="/articles/vue/20220317.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>一次故障分析</span><!----><!--]--><!----></a><!--]--></div></section></div><div class="group" data-v-f332cb62><section class="VPSidebarGroup collapsible collapsed" data-v-f332cb62 data-v-2976c796><div class="title" role="button" data-v-2976c796><h2 class="title-text" data-v-2976c796>Http</h2><div class="action" data-v-2976c796><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-2976c796><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-2976c796><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-2976c796><!--[--><a class="VPLink link link" href="/articles/http/cache.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>缓存</span><!----><!--]--><!----></a><a class="VPLink link link" href="/articles/http/cookie.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>Cookie</span><!----><!--]--><!----></a><a class="VPLink link link" href="/articles/http/proxy.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>Proxy</span><!----><!--]--><!----></a><!--]--></div></section></div><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-ca9ccb7e data-v-c95df128><div class="VPDoc has-sidebar has-aside" data-v-c95df128 data-v-f0af2311><div class="container" data-v-f0af2311><div class="aside" data-v-f0af2311><div class="aside-curtain" data-v-f0af2311></div><div class="aside-container" data-v-f0af2311><div class="aside-content" data-v-f0af2311><div class="VPDocAside" data-v-f0af2311 data-v-aea49c31><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline has-outline" data-v-aea49c31 data-v-a3de185c><div class="content" data-v-a3de185c><div class="outline-marker" data-v-a3de185c></div><div class="outline-title" data-v-a3de185c>On this page</div><nav aria-labelledby="doc-outline-aria-label" data-v-a3de185c><span class="visually-hidden" id="doc-outline-aria-label" data-v-a3de185c> Table of Contents for current page </span><ul class="root" data-v-a3de185c><!--[--><li data-v-a3de185c><a class="outline-link" href="#整体思路" data-v-a3de185c>整体思路</a><!----></li><li data-v-a3de185c><a class="outline-link" href="#具体实现" data-v-a3de185c>具体实现</a><!----></li><li data-v-a3de185c><a class="outline-link" href="#优化" data-v-a3de185c>优化</a><!----></li><li data-v-a3de185c><a class="outline-link" href="#更进一步" data-v-a3de185c>更进一步</a><!----></li><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-aea49c31></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-f0af2311><div class="content-container" data-v-f0af2311><!--[--><!--]--><main class="main" data-v-f0af2311><div style="position:relative;" class="vp-doc _articles_components_fileUpload" data-v-f0af2311><div><h1 id="大文件上传" tabindex="-1">大文件上传 <a class="header-anchor" href="#大文件上传" aria-hidden="true">#</a></h1><h2 id="整体思路" tabindex="-1">整体思路 <a class="header-anchor" href="#整体思路" aria-hidden="true">#</a></h2><p>核心是利用 <em>Blob.prototype.slice</em> 方法，和数组的 slice 方法类似，slice 方法会返回源文件的某个切片。</p><ul><li><h3 id="前端" tabindex="-1">前端 <a class="header-anchor" href="#前端" aria-hidden="true">#</a></h3><p>定义好每个切片的大小，借助 http 的并发性，同时上传多个切片（需要记录好顺序），这样把一个很大的文件变成并发上传多个小的文件切片，可以大大缩减时间，并通过一些优化手段，保证上传的完整性。</p></li><li><h3 id="服务端" tabindex="-1">服务端 <a class="header-anchor" href="#服务端" aria-hidden="true">#</a></h3></li></ul><p>服务端负责接收切片，并在接收到所有切片后合并切片，需要考虑如下问题：</p><ol><li>什么时候合并，如何判断传输完成</li><li>如何合并</li></ol><p>第一个问题前端能够掌握上传的进度，可以在完成后，主动调一个接口通知服务端合并。</p><p>第二个问题很简单，以 Nodejs 为例，通过 readStream/writeStream 操作就可以把所有切片的流合并到最后的文件流。</p><h2 id="具体实现" tabindex="-1">具体实现 <a class="header-anchor" href="#具体实现" aria-hidden="true">#</a></h2><ul><li><h3 id="前端-1" tabindex="-1">前端 <a class="header-anchor" href="#前端-1" aria-hidden="true">#</a></h3><p>页面部分省略，只列出核心代码.</p></li></ul><p>（1）首先实现一个方法用来<strong>生成文件切片</strong>，参数为文件和设置的切片大小(SIZE 默认值为 10M)</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">  createFileChunk(file,size = SIZE){</span></span>
<span class="line"><span style="color:#A6ACCD;">     const fileChunkList = [];</span></span>
<span class="line"><span style="color:#A6ACCD;">     let cur = 0;</span></span>
<span class="line"><span style="color:#A6ACCD;">     while (cur &lt; file.size){</span></span>
<span class="line"><span style="color:#A6ACCD;">        fileChunkList.push({file:file.slice(cur,cur+size)})</span></span>
<span class="line"><span style="color:#A6ACCD;">        cur += size</span></span>
<span class="line"><span style="color:#A6ACCD;">     }</span></span>
<span class="line"><span style="color:#A6ACCD;">     return fileChunkList</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>（2） 其次是上传切片的方法</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">uploadChunks(){</span></span>
<span class="line"><span style="color:#A6ACCD;">    const fileChunkList = this.createFileChunk(file);</span></span>
<span class="line"><span style="color:#A6ACCD;">    const data = fileChunkList.map(({file,name},index)=&gt;{</span></span>
<span class="line"><span style="color:#A6ACCD;">        chunk: file,</span></span>
<span class="line"><span style="color:#A6ACCD;">        hash: name + &#39;-&#39; + index</span></span>
<span class="line"><span style="color:#A6ACCD;">        name</span></span>
<span class="line"><span style="color:#A6ACCD;">    })</span></span>
<span class="line"><span style="color:#A6ACCD;">    const requestList = data.map(({chunk,hash,name})=&gt;{</span></span>
<span class="line"><span style="color:#A6ACCD;">        const formData = new FormData();</span></span>
<span class="line"><span style="color:#A6ACCD;">        formData.append(&quot;chunk&quot;,chunk);</span></span>
<span class="line"><span style="color:#A6ACCD;">        formData.append(&quot;hash&quot;,hash);</span></span>
<span class="line"><span style="color:#A6ACCD;">        formData.append(&quot;fileName&quot;,name)</span></span>
<span class="line"><span style="color:#A6ACCD;">        return this.request({</span></span>
<span class="line"><span style="color:#A6ACCD;">            url:&#39;...&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">            data:formData</span></span>
<span class="line"><span style="color:#A6ACCD;">        })</span></span>
<span class="line"><span style="color:#A6ACCD;">    })</span></span>
<span class="line"><span style="color:#A6ACCD;">    Promise.all(requestList).then(...)</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>hash 暂时用文件名+下标，后端可以知道当前上传的是第几个切片。</p><p>（3）发送合并请求，在上述 then 方法中调用</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">mergeRequest(){</span></span>
<span class="line"><span style="color:#A6ACCD;">    ...</span></span>
<span class="line"><span style="color:#A6ACCD;">    //码省略了，核心就是告诉后端当前哪个文件切片全部上传完毕，参数需要有文件名便于后端判断</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><ul><li><h3 id="服务端（nodejs-为例）" tabindex="-1">服务端（Nodejs 为例） <a class="header-anchor" href="#服务端（nodejs-为例）" aria-hidden="true">#</a></h3></li></ul><p>（1）需要接受所有的切片，用<em>multiparty</em>来处理</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">  const multipart = new multiparty.Form();</span></span>
<span class="line"><span style="color:#A6ACCD;">  ​const dir = path.resolve(__dirname, &quot;..&quot;, &quot;target&quot;);</span></span>
<span class="line"><span style="color:#A6ACCD;">  multipart.parse(req, async (err, fields, files) =&gt; {</span></span>
<span class="line"><span style="color:#A6ACCD;">    if (err) {</span></span>
<span class="line"><span style="color:#A6ACCD;">      return;</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;">    const [chunk] = files.chunk;</span></span>
<span class="line"><span style="color:#A6ACCD;">    const [hash] = fields.hash;</span></span>
<span class="line"><span style="color:#A6ACCD;">    const [filename] = fields.filename;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    // 创建文件夹用于临时存储 chunk </span></span>
<span class="line"><span style="color:#A6ACCD;">    const chunkDir = path.resolve(dir, &#39;chunkDir&#39; + filename);</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">​    // fse用的是fs-extra包，比原生fs模块更好用</span></span>
<span class="line"><span style="color:#A6ACCD;">    if (!fse.existsSync(chunkDir)) {</span></span>
<span class="line"><span style="color:#A6ACCD;">      await fse.mkdirs(chunkDir);</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    await fse.move(chunk.path, `${chunkDir}/${hash`);</span></span>
<span class="line"><span style="color:#A6ACCD;">    res.end(&quot;接收完毕&quot;);</span></span>
<span class="line"><span style="color:#A6ACCD;">  });</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>在接收切片的时候，先创建一个文件夹，以 chunkDir+接收文件名为文件夹名，由于前端加了 hash，所以最后存储的结果就是“xxxx-0、xxxx-1、xxxx-2”</p><p>（2）合并切片</p><p>等接收到所有的切片后，服务端将对所有切片进行合并。</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;"> // 写入文件流</span></span>
<span class="line"><span style="color:#A6ACCD;"> const pipeStream = (path, writeStream) =&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  new Promise(resolve =&gt; {</span></span>
<span class="line"><span style="color:#A6ACCD;">    const readStream = fse.createReadStream(path);</span></span>
<span class="line"><span style="color:#A6ACCD;">    readStream.on(&quot;end&quot;, () =&gt; {</span></span>
<span class="line"><span style="color:#A6ACCD;">      fse.unlinkSync(path);</span></span>
<span class="line"><span style="color:#A6ACCD;">      resolve();</span></span>
<span class="line"><span style="color:#A6ACCD;">    });</span></span>
<span class="line"><span style="color:#A6ACCD;">    readStream.pipe(writeStream);</span></span>
<span class="line"><span style="color:#A6ACCD;">  });</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"> const mergeFileChunk = async (filePath, filename, size) =&gt; {</span></span>
<span class="line"><span style="color:#A6ACCD;">   const chunkDir = path.resolve(UPLOAD_DIR, &#39;chunkDir&#39; + filename);</span></span>
<span class="line"><span style="color:#A6ACCD;">   const chunkPaths = await fse.readdir(chunkDir);</span></span>
<span class="line"><span style="color:#A6ACCD;">   // 根据切片下标进行排序</span></span>
<span class="line"><span style="color:#A6ACCD;">   chunkPaths.sort((a, b) =&gt; a.split(&quot;-&quot;)[1] - b.split(&quot;-&quot;)[1]);</span></span>
<span class="line"><span style="color:#A6ACCD;">   // 并发写入文件</span></span>
<span class="line"><span style="color:#A6ACCD;">   await Promise.all(</span></span>
<span class="line"><span style="color:#A6ACCD;">     chunkPaths.map((chunkPath, index) =&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">       pipeStream(</span></span>
<span class="line"><span style="color:#A6ACCD;">         path.resolve(chunkDir, chunkPath),</span></span>
<span class="line"><span style="color:#A6ACCD;">         // 根据 size 在指定位置创建可写流</span></span>
<span class="line"><span style="color:#A6ACCD;">         fse.createWriteStream(filePath, {</span></span>
<span class="line"><span style="color:#A6ACCD;">           start: index * size,</span></span>
<span class="line"><span style="color:#A6ACCD;">         })</span></span>
<span class="line"><span style="color:#A6ACCD;">       )</span></span>
<span class="line"><span style="color:#A6ACCD;">     )</span></span>
<span class="line"><span style="color:#A6ACCD;">  );</span></span>
<span class="line"><span style="color:#A6ACCD;">  // 合并后删除保存切片的目录</span></span>
<span class="line"><span style="color:#A6ACCD;">  fse.rmdirSync(chunkDir);</span></span>
<span class="line"><span style="color:#A6ACCD;">};</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>服务端根据文件名找到上一步创建的切片文件夹，通过 createWriteStream 将切片文件夹中所有的文件合并，正好 createWriteStream 的第二个参数 start 控制了写入到文件的位置，这样即使并发上传顺序不同，也可以保证合并文件的位置正确。</p><p>合并成功后删除临时的切片目录</p><h2 id="优化" tabindex="-1">优化 <a class="header-anchor" href="#优化" aria-hidden="true">#</a></h2><p>以上可以实现一个最最基本的大文件上传功能，但是现实场景中，会遇到很多问题，我们在这个基础上做一些优化。</p><ul><li><h3 id="查看上传进度" tabindex="-1">查看上传进度 <a class="header-anchor" href="#查看上传进度" aria-hidden="true">#</a></h3></li></ul><p>由于大文件上传很慢，我们需要可视化的查看上传的进度。显然，整体的进度依赖于切片的进度，我们可以监听切片上传的 onProgress 事件，在请求的时候添加：</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">   this.request({</span></span>
<span class="line"><span style="color:#A6ACCD;">            url: &quot;...&quot;,</span></span>
<span class="line"><span style="color:#A6ACCD;">            data: formData，</span></span>
<span class="line"><span style="color:#A6ACCD;">+           onProgress: this.createProgressHandler(file),</span></span>
<span class="line"><span style="color:#A6ACCD;">          })</span></span>
<span class="line"><span style="color:#A6ACCD;">   createProgressHandler(item){</span></span>
<span class="line"><span style="color:#A6ACCD;">        item.percentage = parseInt(String((e.loaded / e.total) * 100));</span></span>
<span class="line"><span style="color:#A6ACCD;">   }</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>这样，在上传的过程中就会更新元素的 percentage 属性。</p><p>然后整体的进度也就是已上传的部分累加，然后除以整个文件的大小。</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">   get Percentage(){</span></span>
<span class="line"><span style="color:#A6ACCD;">       const loaded = this.fileList.map(e =&gt; e.size * e.percentage).reduce((acc,cur)=&gt; acc + cur)</span></span>
<span class="line"><span style="color:#A6ACCD;">       return parseInt(loaded/this.file).toFixed(2)</span></span>
<span class="line"><span style="color:#A6ACCD;">   }</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><ul><li><h3 id="生成-hash" tabindex="-1">生成 hash <a class="header-anchor" href="#生成-hash" aria-hidden="true">#</a></h3></li></ul><p>上述我们用文件名+索引的方式生成 hash，显然是不严谨的，很容易重复。所以我们要用类似于<em>contentHash</em>的思路生成，<strong>当文件内容不变时，hash 就不应该变化</strong>，有现成的<em>spark-md5</em>库使用。</p><p>计算 hash 是个非常耗时的操作，由此可以通过<em>web-worker</em>来完成 hash 的计算，此外，用传说中的<em>requestIdleCallback</em>来利用浏览器的空闲事件计算，也可以。</p><p>代码参考 spark-md5 库的文档，省略。</p><ul><li><h3 id="文件秒传" tabindex="-1">文件秒传 <a class="header-anchor" href="#文件秒传" aria-hidden="true">#</a></h3></li></ul><p>基于上述内容 hash 的处理方式，我们可以实现文件秒传，这里的秒传并不是说瞬间上传完成，而是<strong>根本就不会上传到服务器</strong>，hash 一样的话，表明服务端已经存在了待上传的资源，那么根本就不需要上传了，直接告诉用户上传成功即可。</p><p>具体的实现：</p><p>前端上传前，计算文件的 hash，并发送到服务端验证，服务端验证文件是否存在即可。</p><p>这个似乎和一个著名的梗不谋而合：</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">   &lt;a href=&quot;javascript:alert(&quot;清理成功&quot;)&quot;&gt;清理缓存&lt;/a&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><ul><li><h3 id="断点续传" tabindex="-1">断点续传 <a class="header-anchor" href="#断点续传" aria-hidden="true">#</a></h3></li></ul><p>有的时候，网络突然中断了，导致上传中断，假设在 99%的时候中断了， 用户肯定会崩溃的，因此断点续传是一个非常重要的优化。</p><p>具体思路: 前端上传前，先调用接口获取已上传的切片名，然后上传的时候跳过这些切片，达到续传的效果，也是得益于 hash 的功能。</p><p>这样，我们还可以把这个功能和秒传的接口合并，当前端上传前总是访问这个接口，有两种结果：</p><ul><li>服务端已经有该文件，不需要上传</li><li>服务端不存在该文件，从头上传</li><li>服务端不存在该文件，但是有部分的切片，并且把这些切片返回给前端</li></ul><p>核心代码：</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">  //返回已上传的所有切片名</span></span>
<span class="line"><span style="color:#A6ACCD;">   const createUploadedList = async fileHash =&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">   fse.existsSync(path.resolve(UPLOAD_DIR, fileHash))</span></span>
<span class="line"><span style="color:#A6ACCD;">    ? await fse.readdir(path.resolve(UPLOAD_DIR, fileHash))</span></span>
<span class="line"><span style="color:#A6ACCD;">    : [];</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><h2 id="更进一步" tabindex="-1">更进一步 <a class="header-anchor" href="#更进一步" aria-hidden="true">#</a></h2><p>以上，我们基本完成了一个可用性很高的上传文件组件了，但是还有办法进一步优化，这个需要对 http 有一定的了解，毕竟上传的速度总是和网络挂钩的。</p><ul><li><h3 id="上传策略调整" tabindex="-1">上传策略调整 <a class="header-anchor" href="#上传策略调整" aria-hidden="true">#</a></h3></li></ul><p>TCP 有一个慢启动机制，在开始阶段总会有一段低速传输阶段，这个时候，我们可以动态调整我们上传的切片大小，例如理想状况下一个切片传递需要 30 秒，如果第一个区块花了 60 秒，那么下一个区块就缩小一半，也就是 5M，以此类推。</p><p>但是在并发的场景下，想要实现这样的效果，并未尝试过。。</p><ul><li><h3 id="服务端文件验证" tabindex="-1">服务端文件验证 <a class="header-anchor" href="#服务端文件验证" aria-hidden="true">#</a></h3></li></ul><p>当服务端的文件到达一定的量级，验证是否存在会非常慢，因此要考虑算法来优化，参考 <em>布隆过滤器</em></p><ul><li><h3 id="服务端碎片清理" tabindex="-1">服务端碎片清理 <a class="header-anchor" href="#服务端碎片清理" aria-hidden="true">#</a></h3></li></ul><p>如果服务端存在大量的切片碎片，占用大量的资源，需要定时清理，这个根据业务来做取舍。</p><ul><li><h3 id="分布式的场景" tabindex="-1">分布式的场景 <a class="header-anchor" href="#分布式的场景" aria-hidden="true">#</a></h3></li></ul><p>以上都是讨论的单机场景，当分布式的场景中该如何处理，任重而道远，能力有限，不做讨论。</p></div></div></main><!--[--><!--]--><footer class="VPDocFooter" data-v-f0af2311 data-v-a54a85bd><!----><div class="prev-next" data-v-a54a85bd><div class="pager" data-v-a54a85bd><a class="pager-link prev" href="/articles/components/silentLoadHLS.html" data-v-a54a85bd><span class="desc" data-v-a54a85bd>Previous page</span><span class="title" data-v-a54a85bd>静默加载HLS流</span></a></div><div class="has-prev pager" data-v-a54a85bd><a class="pager-link next" href="/articles/javascript/Proxy.html" data-v-a54a85bd><span class="desc" data-v-a54a85bd>Next page</span><span class="title" data-v-a54a85bd>Proxy</span></a></div></div></footer><!--[--><!--]--></div></div></div></div></div><!----><!--[--><!--]--></div></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"articles_angular_asyncpipe.md\":\"b6773457\",\"articles_angular_cli.md\":\"21dc8aed\",\"articles_angular_forwardref.md\":\"42bc0e8b\",\"articles_angular_httpinterceptors.md\":\"42bd9b03\",\"articles_angular_i18n.md\":\"1c6786f2\",\"articles_angular_ng-components.md\":\"cfb15d81\",\"articles_angular_ngmodule.md\":\"da3f1b72\",\"articles_angular_onpush.md\":\"b639282a\",\"articles_angular_open-in-editor.md\":\"9df02471\",\"articles_angular_reactiveform.md\":\"0c8355a8\",\"articles_angular_rxjs-operators.md\":\"71839171\",\"articles_angular_rxjs.md\":\"3c2d2400\",\"articles_angular_useproviders.md\":\"00e67a79\",\"articles_angular_viewencapsulation.md\":\"4fc21e13\",\"articles_angular_zoneeventsblacklist.md\":\"a65f802c\",\"articles_chromev8_gc.md\":\"3db1fd9b\",\"articles_chromev8_hiddenclass.md\":\"c98835a1\",\"articles_chromev8_inlinecache.md\":\"13ab2122\",\"articles_chromev8_lazycompile.md\":\"19ed99c5\",\"articles_components_fileupload.md\":\"e53cb76d\",\"articles_components_silentloadhls.md\":\"8f7e967b\",\"articles_http_cache.md\":\"9aea689f\",\"articles_http_cookie.md\":\"8961c237\",\"articles_http_proxy.md\":\"8680226a\",\"articles_javascript_decorator.md\":\"f4ccf665\",\"articles_javascript_eventloop.md\":\"ed3a3f76\",\"articles_javascript_promise.md\":\"0c644ab9\",\"articles_javascript_proxy.md\":\"bb5c14f9\",\"articles_javascript_reflect.md\":\"64d126fa\",\"articles_javascript_closure.md\":\"d45ad417\",\"articles_javascript_debounce-throttle.md\":\"84222b99\",\"articles_javascript_scope.md\":\"c8ded14b\",\"articles_javascript_stringify.md\":\"2b1d8c83\",\"articles_javascript_this.md\":\"85162399\",\"articles_map-dev_mapbox.md\":\"bf0778c0\",\"articles_map-dev_mapbox地图开发流程.md\":\"fa0a3160\",\"articles_nodejs_npm-run.md\":\"e71f8004\",\"articles_nodejs_npm.md\":\"db60ea9a\",\"articles_typescript_json2interface.md\":\"be988faa\",\"articles_typescript_逆变与协变.md\":\"797fb438\",\"articles_vue_20220317.md\":\"bc864e28\",\"articles_vue_响应式原理.md\":\"9418ad0b\",\"articles_webpack_assets.md\":\"e2179cab\",\"articles_webpack_modulefederation.md\":\"afc5ff91\",\"articles_webpack_plugin.md\":\"d1ad669f\",\"index.md\":\"771b0270\"}")</script>
    <script type="module" async src="/assets/app.437f86da.js"></script>
    
  </body>
</html>